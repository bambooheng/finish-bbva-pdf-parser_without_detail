# 真实PDF测试指南

## 测试准备

### 1. 文件准备

#### 需要的文件：

1. **真实PDF文档**
   - 示例：`BBVA JUN-JUL真实1-MSN20251016154.pdf`
   - 位置建议：项目根目录或`inputs/`目录

2. **完整的外部流水明细数据**（35条完整记录）
   - 文件名建议：`BBVA_JUN-JUL_complete_transactions.json`
   - 位置建议：项目根目录

---

## 目录结构建议

```
D:\完成版_finish\bbva-pdf-parser_除流水明细外其他部分\
├── main.py
├── inputs/                              # PDF输入文件目录（可选）
│   └── BBVA JUN-JUL真实1-MSN20251016154.pdf
├── external_data/                       # 外部数据目录（建议创建）
│   └── BBVA_JUN-JUL_complete_transactions.json
└── output/                              # 输出目录
    └── test_with_real_pdf/              # 测试输出子目录
```

---

## 步骤1: 准备完整的外部流水明细数据

### 创建外部数据目录

```powershell
# 在项目根目录下创建external_data目录
New-Item -ItemType Directory -Force -Path "external_data"
```

### 创建完整的JSON文件

将您提供的35条完整流水明细数据保存为JSON文件：

**文件路径**: `external_data/BBVA_JUN-JUL_complete_transactions.json`

**文件内容格式**:
```json
{
  "source_file": "BBVA JUN-JUL真实1-MSN20251016154",
  "document_type": "B",
  "total_pages": 1,
  "total_rows": 35,
  "sessions": 1,
  "pages": [
    {
      "page": 0,
      "rows": [
        {
          "fecha_oper": "21/JUN",
          "fecha_liq": "23/JUN",
          "descripcion": "RETIRO CAJERO AUTOMATICO JUN21 11:25 BBVA 9340 FOLIO:8584",
          "referencia": "Referencia ******6929",
          "cargos": 7200.0,
          "abonos": 0.0,
          "saldo_operacion": 5183.2,
          "saldo_liquidacion": 12383.2
        },
        // ... 其余34条记录
      ]
    }
  ]
}
```

---

## 步骤2: 准备PDF文档

### 方法A: 放在项目根目录

```
D:\完成版_finish\bbva-pdf-parser_除流水明细外其他部分\
└── BBVA JUN-JUL真实1-MSN20251016154.pdf
```

### 方法B: 放在inputs目录（推荐）

```powershell
# 创建inputs目录
New-Item -ItemType Directory -Force -Path "inputs"

# 将PDF复制到inputs目录
Copy-Item "PDF所在位置\BBVA JUN-JUL真实1-MSN20251016154.pdf" -Destination "inputs\"
```

---

## 步骤3: 运行测试

### 使用方法A（PDF在根目录）

```powershell
D:\Computer\Anaconda\envs\googlegemini\python.exe main.py `
  --input "BBVA JUN-JUL真实1-MSN20251016154.pdf" `
  --output "output/test_with_real_pdf" `
  --external-transactions "external_data/BBVA_JUN-JUL_complete_transactions.json" `
  --no-validate
```

### 使用方法B（PDF在inputs目录，推荐）

```powershell
D:\Computer\Anaconda\envs\googlegemini\python.exe main.py `
  --input "inputs/BBVA JUN-JUL真实1-MSN20251016154.pdf" `
  --output "output/test_with_real_pdf" `
  --external-transactions "external_data/BBVA_JUN-JUL_complete_transactions.json" `
  --no-validate
```

### 参数说明

- `--input`: PDF文件路径（相对或绝对路径）
- `--output`: 输出目录（会自动创建）
- `--external-transactions`: 外部流水明细JSON文件路径
- `--no-validate`: 跳过验证步骤（加快测试速度）

---

## 步骤4: 查看输出结果

测试完成后，输出文件会保存在：

```
output/test_with_real_pdf/
├── BBVA JUN-JUL真实1-MSN20251016154_structured.json  # 结构化JSON
└── BBVA JUN-JUL真实1-MSN20251016154_transactions.xlsx # Excel文件（可能）
```

### 验证输出内容

```powershell
# 查看JSON文件大小
Get-Item "output/test_with_real_pdf/BBVA JUN-JUL真实1-MSN20251016154_structured.json" | 
  Select-Object Name, Length

# 查看JSON结构
Get-Content "output/test_with_real_pdf/BBVA JUN-JUL真实1-MSN20251016154_structured.json" -Raw | 
  ConvertFrom-Json | 
  Select-Object -ExpandProperty structured_data | 
  Select-Object -ExpandProperty account_summary | 
  Select-Object -Property @{N='Fields';E={$_.PSObject.Properties.Name}}
```

---

## 预期的输出结构

```json
{
  "metadata": {
    "document_type": "从PDF解析",
    "bank": "从PDF解析",
    "account_number": "从PDF解析",
    "total_pages": 从PDF解析,
    "language": "从PDF检测",
    "period": {
      "start": "从PDF解析",
      "end": "从PDF解析"
    }
  },
  "structured_data": {
    "account_summary": {
      "initial_balance": "从PDF解析（如果有）",
      "final_balance": "从PDF解析（如果有）",
      "deposits": "从PDF解析（如果有）",
      "withdrawals": "从PDF解析（如果有）",
      "transaction_details": {
        "source_file": "BBVA JUN-JUL真实1-MSN20251016154",
        "document_type": "B",
        "total_pages": 1,
        "total_rows": 35,
        "sessions": 1,
        "pages": [
          {
            "page": 0,
            "rows": [
              // 完整的35条流水记录
            ]
          }
        ]
      }
    }
  }
}
```

---

## 验证清单

测试完成后，请验证：

- [ ] 输出JSON文件已生成
- [ ] `metadata`部分包含从PDF解析的信息
- [ ] `account_summary`中的余额信息来自PDF（不是计算值）
- [ ] `transaction_details`包含完整的35条流水记录
- [ ] 流水记录格式与外部数据完全一致
- [ ] 没有额外的字段被添加到流水记录中

---

## 快速创建完整测试数据脚本

如果您需要，我可以帮您创建一个脚本来生成完整的35条记录JSON文件。

```powershell
# 将您提供的完整35条数据保存到文件
@"
{
  "source_file": "BBVA JUN-JUL真实1-MSN20251016154",
  "document_type": "B",
  "total_pages": 1,
  "total_rows": 35,
  "sessions": 1,
  "pages": [
    {
      "page": 0,
      "rows": [
        // 粘贴您提供的完整35条记录数据
      ]
    }
  ]
}
"@ | Out-File -FilePath "external_data/BBVA_JUN-JUL_complete_transactions.json" -Encoding UTF8
```

---

## 常见问题

### Q: PDF文件在哪里？
A: 您应该已经有`BBVA JUN-JUL真实1-MSN20251016154.pdf`文件，将其放在：
- `inputs/`目录（推荐）
- 或项目根目录

### Q: 外部数据文件必须放在external_data目录吗？
A: 不是必须的，可以放在任何位置，只要在命令行中指定正确的路径即可。但建议创建`external_data/`目录以便管理。

### Q: 测试时会修改原PDF文件吗？
A: 不会。程序只会读取PDF，所有输出都保存在`output/`目录中。

### Q: 如何确认数据是从PDF解析的而不是计算的？
A: 查看输出JSON中的值，与原PDF文档对比。程序不做计算，只提取文档中显示的值。
