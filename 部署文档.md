# BBVA PDFè§£æç³»ç»Ÿ - éƒ¨ç½²æ–‡æ¡£

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
3. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
4. [å®‰è£…æ­¥éª¤](#å®‰è£…æ­¥éª¤)
5. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
6. [éƒ¨ç½²æ–¹å¼](#éƒ¨ç½²æ–¹å¼)
7. [éªŒè¯æµ‹è¯•](#éªŒè¯æµ‹è¯•)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
9. [ç»´æŠ¤ä¸ç›‘æ§](#ç»´æŠ¤ä¸ç›‘æ§)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç®€ä»‹

BBVA PDFè§£æç³»ç»Ÿæ˜¯ä¸€ä¸ªé«˜ç²¾åº¦çš„é“¶è¡Œå¯¹è´¦å•PDFè§£æå·¥å…·ï¼Œä¸“é—¨ç”¨äºè§£æBBVAï¼ˆå¢¨è¥¿å“¥ï¼‰é“¶è¡Œçš„å¯¹è´¦å•ã€‚ç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **100%ä¿¡æ¯æ•è·**ï¼šæå–æ‰€æœ‰å¯è§å…ƒç´ ï¼ˆæ–‡æœ¬ã€è¡¨æ ¼ã€å›¾åƒã€é¡µçœ‰ã€é¡µè„šï¼‰
- **é›¶é”™è¯¯ä¿è¯**ï¼šå¤šå±‚éªŒè¯ç¡®ä¿å‡†ç¡®æ€§
- **åŠ¨æ€é€‚åº”**ï¼šæ— éœ€ç¡¬ç¼–ç ï¼Œå¯å¤„ç†å„ç§BBVAæ–‡æ¡£å˜ä½“
- **åŒå‘éªŒè¯**ï¼šä»ç»“æ„åŒ–æ•°æ®é‡å»ºPDFå¹¶è¿›è¡Œåƒç´ çº§æ¯”è¾ƒ
- **ä½ç½®ä¿æŒ**ï¼šä¸ºæ¯ä¸ªæå–çš„å…ƒç´ ä¿æŒç²¾ç¡®åæ ‡

### åŠŸèƒ½ç‰¹æ€§

- PDFæ–‡æ¡£OCRè¯†åˆ«ï¼ˆæ”¯æŒMinerUå’ŒTesseractï¼‰
- æ™ºèƒ½å¸ƒå±€åˆ†æ
- è¡¨æ ¼è§£æä¸éªŒè¯
- ç»“æ„åŒ–æ•°æ®æå–
- è¯­ä¹‰åˆ†æï¼ˆåŸºäºLLMï¼‰
- PDFé‡å»ºä¸éªŒè¯
- äº¤æ˜“æ•°æ®å¯¼å‡ºï¼ˆJSONã€Excelï¼‰

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Server    â”‚  (FastAPI)
â”‚   (api_server)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Pipelineâ”‚  (ä¸»å¤„ç†æµç¨‹)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  OCR (MinerU/Tesseract)       â”‚
    â”‚  Layout Analysis              â”‚
    â”‚  Table Parsing                â”‚
    â”‚  Data Extraction              â”‚
    â”‚  Semantic Analysis (LLM)      â”‚
    â”‚  Validation                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

| èµ„æº | æœ€ä½é…ç½® | æ¨èé…ç½® |
|------|---------|---------|
| CPU | 2æ ¸å¿ƒ | 4æ ¸å¿ƒåŠä»¥ä¸Š |
| å†…å­˜ | 4GB | 8GBåŠä»¥ä¸Š |
| ç£ç›˜ç©ºé—´ | 10GB | 20GBåŠä»¥ä¸Š |
| GPU | å¯é€‰ï¼ˆç”¨äºOCRåŠ é€Ÿï¼‰ | æ¨èï¼ˆCUDAæ”¯æŒï¼‰ |

### è½¯ä»¶è¦æ±‚

#### æ“ä½œç³»ç»Ÿ

- **Windows**: Windows 10/11 æˆ– Windows Server 2016+
- **Linux**: Ubuntu 18.04+, CentOS 7+, æˆ–å…¶ä»–ä¸»æµLinuxå‘è¡Œç‰ˆ
- **macOS**: macOS 10.14+

#### å¿…éœ€è½¯ä»¶

1. **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæ¨è 3.9+ï¼‰
2. **MinerU**: OCRå·¥å…·ï¼ˆéœ€è¦å•ç‹¬å®‰è£…ï¼Œè§ä¸‹æ–‡ï¼‰
3. **Tesseract OCR**: å¤‡ç”¨OCRå¼•æ“ï¼ˆå¯é€‰ï¼Œä½†æ¨èå®‰è£…ï¼‰

#### ç½‘ç»œè¦æ±‚

- èƒ½å¤Ÿè®¿é—®äº’è”ç½‘ï¼ˆç”¨äºè°ƒç”¨LLM APIï¼‰
- å¦‚æœä½¿ç”¨Anthropic APIï¼Œéœ€è¦èƒ½å¤Ÿè®¿é—® `api.anthropic.com`
- å¦‚æœä½¿ç”¨OpenAI APIï¼Œéœ€è¦èƒ½å¤Ÿè®¿é—® `api.openai.com`

---

## ç¯å¢ƒå‡†å¤‡

### 1. Pythonç¯å¢ƒå®‰è£…

#### Windowsç³»ç»Ÿ

1. ä¸‹è½½Pythonå®‰è£…åŒ…ï¼š
   - è®¿é—® https://www.python.org/downloads/
   - ä¸‹è½½Python 3.9æˆ–æ›´é«˜ç‰ˆæœ¬
   - **é‡è¦**ï¼šå®‰è£…æ—¶å‹¾é€‰"Add Python to PATH"

2. éªŒè¯å®‰è£…ï¼š
   ```powershell
   python --version
   pip --version
   ```

#### Linuxç³»ç»Ÿ

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3 python3-pip python3-venv

# CentOS/RHEL
sudo yum install python3 python3-pip
```

#### macOSç³»ç»Ÿ

```bash
# ä½¿ç”¨Homebrew
brew install python3

# æˆ–ä»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…
```

### 2. MinerUå®‰è£…é…ç½®

MinerUæ˜¯ç³»ç»Ÿçš„ä¸»è¦OCRå¼•æ“ï¼Œéœ€è¦å•ç‹¬å®‰è£…ã€‚

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨Anacondaç¯å¢ƒï¼ˆæ¨èï¼‰

1. å®‰è£…Anacondaæˆ–Minicondaï¼š
   - ä¸‹è½½åœ°å€ï¼šhttps://www.anaconda.com/products/distribution

2. åˆ›å»ºMinerUä¸“ç”¨ç¯å¢ƒï¼š
   ```bash
   conda create -n mineru python=3.9
   conda activate mineru
   ```

3. å®‰è£…MinerUï¼š
   ```bash
   # æ ¹æ®MinerUå®˜æ–¹æ–‡æ¡£å®‰è£…
   # é€šå¸¸éœ€è¦ï¼š
   pip install mineru
   # æˆ–ä»æºç å®‰è£…
   ```

4. éªŒè¯å®‰è£…ï¼š
   ```bash
   python -c "import mineru; print('MinerU installed successfully')"
   ```

5. è®°å½•Pythonè·¯å¾„ï¼š
   ```bash
   # Windows
   where python
   
   # Linux/macOS
   which python
   ```
   
   å°†è·¯å¾„è®°å½•ï¼Œåç»­é…ç½®éœ€è¦ç”¨åˆ°ã€‚

#### æ–¹å¼äºŒï¼šä½¿ç”¨ç³»ç»ŸPythonç¯å¢ƒ

å¦‚æœMinerUå·²å®‰è£…åœ¨ç³»ç»ŸPythonç¯å¢ƒä¸­ï¼Œç›´æ¥ä½¿ç”¨ç³»ç»ŸPythonè·¯å¾„å³å¯ã€‚

### 3. Tesseract OCRå®‰è£…ï¼ˆå¯é€‰ä½†æ¨èï¼‰

#### Windows

1. ä¸‹è½½å®‰è£…åŒ…ï¼š
   - è®¿é—® https://github.com/UB-Mannheim/tesseract/wiki
   - ä¸‹è½½Windowså®‰è£…åŒ…ï¼ˆæ¨è64ä½ç‰ˆæœ¬ï¼‰

2. å®‰è£…ï¼š
   - è¿è¡Œå®‰è£…ç¨‹åº
   - **é‡è¦**ï¼šè®°å½•å®‰è£…è·¯å¾„ï¼ˆé»˜è®¤ï¼š`C:\Program Files\Tesseract-OCR`ï¼‰

3. æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡ï¼š
   ```powershell
   # ä¸´æ—¶æ·»åŠ ï¼ˆå½“å‰ä¼šè¯ï¼‰
   $env:Path += ";C:\Program Files\Tesseract-OCR"
   
   # æ°¸ä¹…æ·»åŠ ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
   [Environment]::SetEnvironmentVariable("Path", $env:Path + ";C:\Program Files\Tesseract-OCR", "Machine")
   ```

4. éªŒè¯å®‰è£…ï¼š
   ```powershell
   tesseract --version
   ```

#### Linux

```bash
# Ubuntu/Debian
sudo apt install tesseract-ocr

# CentOS/RHEL
sudo yum install tesseract
```

#### macOS

```bash
brew install tesseract
```

### 4. ç³»ç»Ÿä¾èµ–å®‰è£…

#### Windows

æŸäº›PythonåŒ…å¯èƒ½éœ€è¦ç³»ç»Ÿåº“æ”¯æŒï¼š

- **Visual C++ Redistributable**: æŸäº›åŒ…ï¼ˆå¦‚opencv-pythonï¼‰éœ€è¦
  - ä¸‹è½½åœ°å€ï¼šhttps://aka.ms/vs/17/release/vc_redist.x64.exe

#### Linux

```bash
# Ubuntu/Debian
sudo apt install build-essential libssl-dev libffi-dev python3-dev

# å›¾åƒå¤„ç†æ”¯æŒ
sudo apt install libjpeg-dev zlib1g-dev libpng-dev

# Tesseractä¾èµ–
sudo apt install libtesseract-dev
```

#### macOS

```bash
brew install openssl libffi
```

---

## å®‰è£…æ­¥éª¤

### æ­¥éª¤1ï¼šè·å–é¡¹ç›®ä»£ç 

```bash
# å¦‚æœä½¿ç”¨Git
git clone <repository-url>
cd bbva-pdf-parser_éƒ¨ç½²ç‰ˆæœ¬_20251126

# æˆ–ç›´æ¥è§£å‹é¡¹ç›®å‹ç¼©åŒ…åˆ°ç›®æ ‡ç›®å½•
```

### æ­¥éª¤2ï¼šåˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate

# Linux/macOS
source venv/bin/activate
```

### æ­¥éª¤3ï¼šå®‰è£…Pythonä¾èµ–

```bash
# å®‰è£…æ ¸å¿ƒä¾èµ–
pip install -r requirements.txt

# å®‰è£…APIæœåŠ¡ä¾èµ–ï¼ˆå¦‚æœä½¿ç”¨APIæœåŠ¡ï¼‰
pip install -r requirements_api.txt

# æˆ–ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt -r requirements_api.txt
```

**æ³¨æ„**ï¼šå¦‚æœå®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œè¯·å‚è€ƒ[å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)éƒ¨åˆ†ã€‚

### æ­¥éª¤4ï¼šéªŒè¯ä¾èµ–å®‰è£…

```bash
# æ£€æŸ¥å…³é”®åŒ…æ˜¯å¦å®‰è£…æˆåŠŸ
python -c "import fitz; print('PyMuPDF OK')"
python -c "import cv2; print('OpenCV OK')"
python -c "import pandas; print('Pandas OK')"
python -c "import fastapi; print('FastAPI OK')"
```

### æ­¥éª¤5ï¼šé…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰ï¼š

```bash
# Windows PowerShell
New-Item -Path .env -ItemType File

# Linux/macOS
touch .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ APIå¯†é’¥ï¼š

```env
# Anthropic APIå¯†é’¥ï¼ˆå¦‚æœä½¿ç”¨Claudeï¼‰
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# æˆ– OpenAI APIå¯†é’¥ï¼ˆå¦‚æœä½¿ç”¨GPTï¼‰
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# æ³¨æ„ï¼šåªèƒ½é…ç½®ä¸€ä¸ªï¼Œæ ¹æ®config.yamlä¸­çš„providerè®¾ç½®é€‰æ‹©
```

**å®‰å…¨æç¤º**ï¼š
- ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
- APIå¯†é’¥åº”å®šæœŸè½®æ¢

### æ­¥éª¤6ï¼šé…ç½®config.yaml

ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼Œæ ¹æ®å®é™…ç¯å¢ƒä¿®æ”¹é…ç½®ï¼š

```yaml
# MinerUé…ç½®
mineru:
  python_path: "D:\\App\\Anaconda3\\envs\\mineru\\python.exe"  # ä¿®æ”¹ä¸ºå®é™…çš„MinerU Pythonè·¯å¾„
  mineru_path: ""  # å¦‚æœMinerUéœ€è¦ç‰¹æ®Šè·¯å¾„ï¼Œåœ¨æ­¤é…ç½®
  timeout: 300  # OCRè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰

# OCRè®¾ç½®
ocr:
  primary_engine: "mineru"  # ä¸»OCRå¼•æ“ï¼šmineru æˆ– tesseract
  fallback_engine: "tesseract"  # å¤‡ç”¨OCRå¼•æ“
  confidence_threshold: 0.7  # OCRç½®ä¿¡åº¦é˜ˆå€¼
  dual_verification_enabled: true  # æ˜¯å¦å¯ç”¨åŒé‡éªŒè¯

# LLMé…ç½®
llm:
  provider: "anthropic"  # anthropic æˆ– openai
  model: "claude-3-opus-20240229"  # æˆ– "gpt-4" for OpenAI
  api_key_env: "ANTHROPIC_API_KEY"  # ç¯å¢ƒå˜é‡åç§°
  temperature: 0.1  # æ¸©åº¦å‚æ•°ï¼ˆè¶Šä½è¶Šç¡®å®šï¼‰
  max_tokens: 4096  # æœ€å¤§tokenæ•°

# éªŒè¯è®¾ç½®
validation:
  pixel_tolerance: 1  # åƒç´ å®¹å·®
  enable_pdf_rebuild: true  # å¯ç”¨PDFé‡å»º
  enable_pixel_comparison: true  # å¯ç”¨åƒç´ çº§æ¯”è¾ƒ
  enable_semantic_validation: true  # å¯ç”¨è¯­ä¹‰éªŒè¯
  min_confidence: 0.8  # æœ€å°ç½®ä¿¡åº¦

# è¾“å‡ºè®¾ç½®
output:
  save_intermediate_results: true  # ä¿å­˜ä¸­é—´ç»“æœ
  output_directory: "output"  # è¾“å‡ºç›®å½•
  detailed_reports: true  # è¯¦ç»†æŠ¥å‘Š
```

**é‡è¦é…ç½®é¡¹è¯´æ˜**ï¼š

1. **mineru.python_path**: 
   - Windowsè·¯å¾„ä½¿ç”¨åŒåæ–œæ ï¼š`D:\\App\\Anaconda3\\python.exe`
   - Linux/macOSä½¿ç”¨æ­£æ–œæ ï¼š`/usr/bin/python3`
   - å¿…é¡»æŒ‡å‘å®‰è£…äº†MinerUçš„Pythonç¯å¢ƒ

2. **llm.provider**: 
   - é€‰æ‹© `anthropic` ä½¿ç”¨Claude API
   - é€‰æ‹© `openai` ä½¿ç”¨OpenAI API
   - ç¡®ä¿å¯¹åº”çš„APIå¯†é’¥å·²é…ç½®åœ¨ `.env` æ–‡ä»¶ä¸­

3. **ocr.primary_engine**:
   - æ¨èä½¿ç”¨ `mineru`ï¼ˆæ›´å‡†ç¡®ï¼‰
   - å¦‚æœMinerUä¸å¯ç”¨ï¼Œå¯è®¾ç½®ä¸º `tesseract`

### æ­¥éª¤7ï¼šåˆ›å»ºå¿…è¦çš„ç›®å½•

```bash
# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir output
mkdir inputs

# Windows PowerShell
New-Item -ItemType Directory -Path output
New-Item -ItemType Directory -Path inputs
```

---

## é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ç»“æ„

é¡¹ç›®ä½¿ç”¨ `config.yaml` ä½œä¸ºä¸»é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒä»¥ä¸‹é…ç½®é¡¹ï¼š

#### MinerUé…ç½®

```yaml
mineru:
  python_path: "è·¯å¾„"  # MinerU Pythonå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
  mineru_path: ""  # MinerUå®‰è£…è·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰
  timeout: 300  # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
```

#### OCRé…ç½®

```yaml
ocr:
  primary_engine: "mineru"  # ä¸»å¼•æ“ï¼šmineru/tesseract
  fallback_engine: "tesseract"  # å¤‡ç”¨å¼•æ“
  confidence_threshold: 0.7  # ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆ0-1ï¼‰
  dual_verification_enabled: true  # åŒé‡éªŒè¯
```

#### LLMé…ç½®

```yaml
llm:
  provider: "anthropic"  # anthropic/openai
  model: "claude-3-opus-20240229"  # æ¨¡å‹åç§°
  api_key_env: "ANTHROPIC_API_KEY"  # ç¯å¢ƒå˜é‡å
  temperature: 0.1  # æ¸©åº¦ï¼ˆ0-1ï¼‰
  max_tokens: 4096  # æœ€å¤§token
```

#### éªŒè¯é…ç½®

```yaml
validation:
  pixel_tolerance: 1  # åƒç´ å®¹å·®
  enable_pdf_rebuild: true  # PDFé‡å»º
  enable_pixel_comparison: true  # åƒç´ æ¯”è¾ƒ
  enable_semantic_validation: true  # è¯­ä¹‰éªŒè¯
  min_confidence: 0.8  # æœ€å°ç½®ä¿¡åº¦
```

#### é“¶è¡Œé…ç½®

ç³»ç»Ÿæ”¯æŒå¤šé“¶è¡Œé…ç½®ï¼Œå½“å‰ä¸»è¦é…ç½®BBVA Mexicoï¼š

```yaml
bank_profiles:
  bbva_mexico:
    name: "BBVA Mexico"
    currency: "MXN"
    currency_symbol: "$"
    # ... å…¶ä»–é…ç½®
```

### ç¯å¢ƒå˜é‡

ç³»ç»Ÿæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®ï¼š

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| `CONFIG_PATH` | é…ç½®æ–‡ä»¶è·¯å¾„ | `CONFIG_PATH=/path/to/config.yaml` |
| `ANTHROPIC_API_KEY` | Anthropic APIå¯†é’¥ | `ANTHROPIC_API_KEY=sk-ant-...` |
| `OPENAI_API_KEY` | OpenAI APIå¯†é’¥ | `OPENAI_API_KEY=sk-...` |
| `API_HOST` | APIæœåŠ¡ä¸»æœº | `API_HOST=0.0.0.0` |
| `API_PORT` | APIæœåŠ¡ç«¯å£ | `API_PORT=8000` |
| `API_WORKERS` | APIå·¥ä½œè¿›ç¨‹æ•° | `API_WORKERS=4` |
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | `LOG_LEVEL=info` |
| `CORS_ORIGINS` | CORSå…è®¸æº | `CORS_ORIGINS=http://localhost:3000,https://example.com` |

---

## éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œå·¥å…·éƒ¨ç½²

é€‚ç”¨äºå•æœºä½¿ç”¨ã€æ‰¹å¤„ç†ä»»åŠ¡ç­‰åœºæ™¯ã€‚

#### åŸºæœ¬ä½¿ç”¨

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœä½¿ç”¨ï¼‰
# Windows
venv\Scripts\activate
# Linux/macOS
source venv/bin/activate

# è§£æå•ä¸ªPDF
python main.py --input path/to/bbva_statement.pdf --output output/

# è·³è¿‡éªŒè¯ï¼ˆæ›´å¿«ï¼Œä½†å‡†ç¡®æ€§é™ä½ï¼‰
python main.py --input path/to/bbva_statement.pdf --output output/ --no-validate

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
python main.py --input path/to/bbva_statement.pdf --output output/ --config custom_config.yaml
```

#### è¾“å‡ºç»“æœ

å¤„ç†å®Œæˆåï¼Œåœ¨è¾“å‡ºç›®å½•ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

- `*_structured.json`: ç»“æ„åŒ–æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
- `*_transactions.xlsx`: äº¤æ˜“æ•°æ®ï¼ˆExcelæ ¼å¼ï¼‰
- `*_reconstructed.pdf`: é‡å»ºçš„PDFï¼ˆç”¨äºéªŒè¯ï¼‰
- `validation_report.json`: éªŒè¯æŠ¥å‘Š
- `comparison_report.json`: æ¯”è¾ƒæŠ¥å‘Š
- `comparison_report.md`: æ¯”è¾ƒæŠ¥å‘Šï¼ˆMarkdownæ ¼å¼ï¼‰

### æ–¹å¼äºŒï¼šAPIæœåŠ¡éƒ¨ç½²

é€‚ç”¨äºéœ€è¦é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿã€æä¾›WebæœåŠ¡çš„åœºæ™¯ã€‚

#### å¼€å‘æ¨¡å¼å¯åŠ¨

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# Linux/macOS
source venv/bin/activate

# å¯åŠ¨APIæœåŠ¡
python api_server.py
```

é»˜è®¤é…ç½®ï¼š
- ä¸»æœºï¼š`0.0.0.0`
- ç«¯å£ï¼š`8000`
- å·¥ä½œè¿›ç¨‹ï¼š1ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

#### ç”Ÿäº§æ¨¡å¼å¯åŠ¨

ä½¿ç”¨ `uvicorn` ç›´æ¥å¯åŠ¨ï¼ˆæ¨èï¼‰ï¼š

```bash
# å•è¿›ç¨‹æ¨¡å¼
uvicorn api_server:app --host 0.0.0.0 --port 8000

# å¤šè¿›ç¨‹æ¨¡å¼ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
uvicorn api_server:app --host 0.0.0.0 --port 8000 --workers 4

# æŒ‡å®šæ—¥å¿—çº§åˆ«
uvicorn api_server:app --host 0.0.0.0 --port 8000 --workers 4 --log-level info
```

#### ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®

```bash
# Windows PowerShell
$env:API_HOST="0.0.0.0"
$env:API_PORT="8000"
$env:API_WORKERS="4"
$env:LOG_LEVEL="info"
python api_server.py

# Linux/macOS
export API_HOST=0.0.0.0
export API_PORT=8000
export API_WORKERS=4
export LOG_LEVEL=info
python api_server.py
```

#### ä½¿ç”¨systemdæœåŠ¡ï¼ˆLinuxï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/bbva-pdf-parser.service`ï¼š

```ini
[Unit]
Description=BBVA PDF Parser API Service
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/bbva-pdf-parser_éƒ¨ç½²ç‰ˆæœ¬_20251126
Environment="PATH=/path/to/venv/bin"
Environment="API_HOST=0.0.0.0"
Environment="API_PORT=8000"
Environment="API_WORKERS=4"
ExecStart=/path/to/venv/bin/uvicorn api_server:app --host 0.0.0.0 --port 8000 --workers 4
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl enable bbva-pdf-parser
sudo systemctl start bbva-pdf-parser
sudo systemctl status bbva-pdf-parser
```

#### ä½¿ç”¨Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦é€šè¿‡Nginxæä¾›HTTPSå’Œè´Ÿè½½å‡è¡¡ï¼š

```nginx
upstream bbva_parser {
    server 127.0.0.1:8000;
    # å¯ä»¥æ·»åŠ å¤šä¸ªåç«¯æœåŠ¡å™¨
    # server 127.0.0.1:8001;
}

server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://bbva_parser;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆPDFå¤„ç†å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰
        proxy_read_timeout 600s;
        proxy_connect_timeout 600s;
        proxy_send_timeout 600s;
    }
}
```

#### APIæ¥å£è¯´æ˜

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹å®Œæ•´çš„APIæ–‡æ¡£ã€‚

**ä¸»è¦æ¥å£**ï¼š

1. **å¥åº·æ£€æŸ¥**
   ```
   GET /health
   ```

2. **è§£æPDFï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰**
   ```
   POST /parse
   Content-Type: multipart/form-data
   Body: file (PDFæ–‡ä»¶), validate (boolean), output_dir (string, optional)
   ```

3. **è§£æPDFï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰**
   ```
   POST /parse/path
   Content-Type: application/json
   Body: {
     "pdf_path": "/path/to/file.pdf",
     "validate": true,
     "output_dir": "/path/to/output" (optional)
   }
   ```

4. **æ‰¹é‡è§£æ**
   ```
   POST /parse/batch
   Content-Type: application/json
   Body: {
     "pdf_paths": ["/path/to/file1.pdf", "/path/to/file2.pdf"],
     "validate": true
   }
   ```

5. **æå–äº¤æ˜“æ•°æ®**
   ```
   GET /transactions?pdf_path=/path/to/file.pdf&validate=true
   ```

**ç¤ºä¾‹è¯·æ±‚**ï¼ˆä½¿ç”¨curlï¼‰ï¼š

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æ–‡ä»¶ä¸Šä¼ è§£æ
curl -X POST "http://localhost:8000/parse" \
  -F "file=@/path/to/bbva_statement.pdf" \
  -F "validate=true"

# æ–‡ä»¶è·¯å¾„è§£æ
curl -X POST "http://localhost:8000/parse/path" \
  -H "Content-Type: application/json" \
  -d '{
    "pdf_path": "/path/to/bbva_statement.pdf",
    "validate": true
  }'
```

### æ–¹å¼ä¸‰ï¼šDockeréƒ¨ç½²ï¼ˆå¦‚æœæä¾›Dockerfileï¼‰

å¦‚æœé¡¹ç›®åŒ…å«Dockerfileï¼Œå¯ä»¥ä½¿ç”¨Dockeréƒ¨ç½²ï¼š

```bash
# æ„å»ºé•œåƒ
docker build -t bbva-pdf-parser:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name bbva-pdf-parser \
  -p 8000:8000 \
  -v /path/to/config.yaml:/app/config.yaml \
  -v /path/to/.env:/app/.env \
  -v /path/to/output:/app/output \
  -e API_HOST=0.0.0.0 \
  -e API_PORT=8000 \
  bbva-pdf-parser:latest
```

---

## éªŒè¯æµ‹è¯•

### 1. ç¯å¢ƒéªŒè¯

```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version  # åº”è¯¥ >= 3.8

# æ£€æŸ¥å…³é”®ä¾èµ–
python -c "import fitz, cv2, pandas, fastapi; print('All dependencies OK')"

# æ£€æŸ¥MinerUï¼ˆå¦‚æœé…ç½®ï¼‰
python -c "import mineru; print('MinerU OK')"  # åœ¨MinerUç¯å¢ƒä¸­

# æ£€æŸ¥Tesseract
tesseract --version
```

### 2. é…ç½®éªŒè¯

```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶åŠ è½½
python -c "from src.config import config; print('Config loaded:', config.get('llm.provider'))"

# æµ‹è¯•APIå¯†é’¥
python -c "import os; from dotenv import load_dotenv; load_dotenv(); print('API Key:', os.getenv('ANTHROPIC_API_KEY')[:10] + '...' if os.getenv('ANTHROPIC_API_KEY') else 'Not found')"
```

### 3. åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•å‘½ä»¤è¡Œå·¥å…·

```bash
# ä½¿ç”¨æµ‹è¯•PDFæ–‡ä»¶
python main.py --input inputs/test_bbva.pdf --output output/

# æ£€æŸ¥è¾“å‡ºæ–‡ä»¶
ls output/
# åº”è¯¥çœ‹åˆ°ï¼š
# - *_structured.json
# - *_transactions.xlsx
# - validation_report.json
```

#### æµ‹è¯•APIæœåŠ¡

```bash
# å¯åŠ¨APIæœåŠ¡
python api_server.py

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ï¼ˆå¦‚æœæœ‰æµ‹è¯•PDFï¼‰
curl -X POST "http://localhost:8000/parse" \
  -F "file=@inputs/test_bbva.pdf" \
  -F "validate=true"
```

### 4. æ€§èƒ½æµ‹è¯•

```bash
# æµ‹è¯•å¤„ç†æ—¶é—´
time python main.py --input inputs/test_bbva.pdf --output output/

# æµ‹è¯•APIå“åº”æ—¶é—´
curl -w "@-" -o /dev/null -s "http://localhost:8000/health" <<'EOF'
     time_namelookup:  %{time_namelookup}\n
        time_connect:  %{time_connect}\n
     time_appconnect:  %{time_appconnect}\n
    time_pretransfer:  %{time_pretransfer}\n
       time_redirect:  %{time_redirect}\n
  time_starttransfer:  %{time_starttransfer}\n
                     ----------\n
          time_total:  %{time_total}\n
EOF
```

---

## å¸¸è§é—®é¢˜

### å®‰è£…é—®é¢˜

#### Q1: pipå®‰è£…ä¾èµ–æ—¶å‡ºç°é”™è¯¯

**é—®é¢˜**ï¼š`error: Microsoft Visual C++ 14.0 or greater is required`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- Windowsï¼šå®‰è£… Visual Studio Build Tools æˆ– Visual C++ Redistributable
- ä¸‹è½½åœ°å€ï¼šhttps://visualstudio.microsoft.com/visual-cpp-build-tools/

#### Q2: æ— æ³•å®‰è£…opencv-python

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å°è¯•ä½¿ç”¨é¢„ç¼–è¯‘ç‰ˆæœ¬
pip install opencv-python-headless

# æˆ–æŒ‡å®šç‰ˆæœ¬
pip install opencv-python==4.8.0
```

#### Q3: Tesseractæ‰¾ä¸åˆ°

**é—®é¢˜**ï¼š`TesseractNotFoundError`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- Windowsï¼šç¡®ä¿Tesseractå·²å®‰è£…å¹¶æ·»åŠ åˆ°PATH
- Linuxï¼š`sudo apt install tesseract-ocr`
- macOSï¼š`brew install tesseract`

### é…ç½®é—®é¢˜

#### Q4: MinerUè·¯å¾„é…ç½®é”™è¯¯

**é—®é¢˜**ï¼š`FileNotFoundError: [WinError 2] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤MinerU Pythonè·¯å¾„æ­£ç¡®
2. Windowsè·¯å¾„ä½¿ç”¨åŒåæ–œæ ï¼š`D:\\App\\Anaconda3\\python.exe`
3. æµ‹è¯•è·¯å¾„ï¼šåœ¨å‘½ä»¤è¡Œè¿è¡Œè¯¥è·¯å¾„ï¼Œç¡®è®¤å¯ä»¥æ‰§è¡Œ

#### Q5: APIå¯†é’¥æœªæ‰¾åˆ°

**é—®é¢˜**ï¼š`API key not found`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤ç¯å¢ƒå˜é‡åç§°ä¸ `config.yaml` ä¸­çš„ `api_key_env` ä¸€è‡´
3. æ£€æŸ¥ `.env` æ–‡ä»¶æ ¼å¼ï¼ˆæ— å¼•å·ï¼Œæ— ç©ºæ ¼ï¼‰
4. é‡å¯æœåŠ¡ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ

### è¿è¡Œé—®é¢˜

#### Q6: OCRå¤„ç†è¶…æ—¶

**é—®é¢˜**ï¼š`TimeoutError: MinerU processing timeout`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¢åŠ  `config.yaml` ä¸­çš„ `mineru.timeout` å€¼
2. æ£€æŸ¥PDFæ–‡ä»¶å¤§å°å’Œå¤æ‚åº¦
3. è€ƒè™‘ä½¿ç”¨Tesseractä½œä¸ºå¤‡ç”¨å¼•æ“

#### Q7: å†…å­˜ä¸è¶³

**é—®é¢˜**ï¼š`MemoryError` æˆ–ç³»ç»Ÿå¡æ­»

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¢åŠ ç³»ç»Ÿå†…å­˜
2. å¤„ç†å¤§æ–‡ä»¶æ—¶å…³é—­å…¶ä»–åº”ç”¨
3. è€ƒè™‘åˆ†æ‰¹å¤„ç†æˆ–ä½¿ç”¨æµå¼å¤„ç†

#### Q8: APIæœåŠ¡æ— æ³•å¯åŠ¨

**é—®é¢˜**ï¼šç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# Windows: æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :8000
taskkill /PID <PID> /F

# Linux/macOS: æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8000
kill -9 <PID>

# æˆ–æ›´æ”¹ç«¯å£
export API_PORT=8001
python api_server.py
```

### åŠŸèƒ½é—®é¢˜

#### Q9: è§£æç»“æœä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥PDFè´¨é‡ï¼ˆæ‰«æä»¶å¯èƒ½éœ€è¦é¢„å¤„ç†ï¼‰
2. è°ƒæ•´OCRç½®ä¿¡åº¦é˜ˆå€¼
3. å¯ç”¨åŒé‡éªŒè¯
4. æ£€æŸ¥LLM APIæ˜¯å¦æ­£å¸¸å·¥ä½œ
5. æŸ¥çœ‹éªŒè¯æŠ¥å‘Šäº†è§£å…·ä½“é—®é¢˜

#### Q10: äº¤æ˜“æ•°æ®ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥PDFæ˜¯å¦åŒ…å«äº¤æ˜“è¡¨æ ¼
2. æŸ¥çœ‹ `validation_report.json` äº†è§£æå–æƒ…å†µ
3. å°è¯•è°ƒæ•´è¡¨æ ¼è§£æå‚æ•°
4. æ£€æŸ¥é“¶è¡Œé…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®

---

## ç»´æŠ¤ä¸ç›‘æ§

### æ—¥å¿—ç®¡ç†

#### æ—¥å¿—ä½ç½®

- APIæœåŠ¡æ—¥å¿—ï¼š`api_server.log`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
- åº”ç”¨æ—¥å¿—ï¼šå¯é€šè¿‡ç¯å¢ƒå˜é‡ `LOG_LEVEL` æ§åˆ¶

#### æ—¥å¿—çº§åˆ«

- `DEBUG`: è¯¦ç»†è°ƒè¯•ä¿¡æ¯
- `INFO`: ä¸€èˆ¬ä¿¡æ¯ï¼ˆé»˜è®¤ï¼‰
- `WARNING`: è­¦å‘Šä¿¡æ¯
- `ERROR`: é”™è¯¯ä¿¡æ¯
- `CRITICAL`: ä¸¥é‡é”™è¯¯

#### æ—¥å¿—è½®è½¬ï¼ˆLinuxï¼‰

ä½¿ç”¨ `logrotate` é…ç½®æ—¥å¿—è½®è½¬ï¼š

```bash
# /etc/logrotate.d/bbva-pdf-parser
/path/to/bbva-pdf-parser_éƒ¨ç½²ç‰ˆæœ¬_20251126/api_server.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 user group
}
```

### æ€§èƒ½ç›‘æ§

#### å…³é”®æŒ‡æ ‡

1. **å¤„ç†æ—¶é—´**ï¼šå•ä¸ªPDFçš„å¹³å‡å¤„ç†æ—¶é—´
2. **æˆåŠŸç‡**ï¼šè§£ææˆåŠŸçš„PDFæ¯”ä¾‹
3. **APIå“åº”æ—¶é—´**ï¼šAPIæ¥å£çš„å¹³å‡å“åº”æ—¶é—´
4. **èµ„æºä½¿ç”¨**ï¼šCPUã€å†…å­˜ä½¿ç”¨ç‡

#### ç›‘æ§å·¥å…·

- **ç³»ç»Ÿç›‘æ§**ï¼š`htop`ã€`top`ã€Windowsä»»åŠ¡ç®¡ç†å™¨
- **APIç›‘æ§**ï¼šFastAPIå†…ç½®çš„ `/docs` å’Œ `/redoc` ç«¯ç‚¹
- **æ—¥å¿—åˆ†æ**ï¼š`grep`ã€`tail`ã€æˆ–æ—¥å¿—åˆ†æå·¥å…·

### å¤‡ä»½ç­–ç•¥

#### éœ€è¦å¤‡ä»½çš„å†…å®¹

1. **é…ç½®æ–‡ä»¶**ï¼š
   - `config.yaml`
   - `.env`ï¼ˆAPIå¯†é’¥ï¼‰

2. **ä»£ç **ï¼š
   - æ•´ä¸ªé¡¹ç›®ç›®å½•

3. **æ•°æ®**ï¼š
   - è¾“å‡ºç›®å½•ï¼ˆå¦‚æœéœ€è¦ä¿ç•™å†å²ç»“æœï¼‰

#### å¤‡ä»½å»ºè®®

- é…ç½®æ–‡ä»¶ï¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆGitï¼‰
- APIå¯†é’¥ï¼šä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚AWS Secrets Managerã€Azure Key Vaultï¼‰
- è¾“å‡ºæ•°æ®ï¼šå®šæœŸå½’æ¡£åˆ°å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚S3ã€OSSï¼‰

### æ›´æ–°å‡çº§

#### æ›´æ–°æ­¥éª¤

1. **å¤‡ä»½å½“å‰ç‰ˆæœ¬**ï¼š
   ```bash
   cp -r bbva-pdf-parser_éƒ¨ç½²ç‰ˆæœ¬_20251126 bbva-pdf-parser_backup_$(date +%Y%m%d)
   ```

2. **æ›´æ–°ä»£ç **ï¼š
   ```bash
   # å¦‚æœä½¿ç”¨Git
   git pull origin main
   
   # æˆ–è§£å‹æ–°ç‰ˆæœ¬
   ```

3. **æ›´æ–°ä¾èµ–**ï¼š
   ```bash
   pip install -r requirements.txt --upgrade
   pip install -r requirements_api.txt --upgrade
   ```

4. **æ£€æŸ¥é…ç½®**ï¼š
   - å¯¹æ¯”æ–°æ—§ `config.yaml`
   - æ›´æ–°å¿…è¦çš„é…ç½®é¡¹

5. **æµ‹è¯•éªŒè¯**ï¼š
   - è¿è¡Œæµ‹è¯•ç”¨ä¾‹
   - éªŒè¯åŠŸèƒ½æ­£å¸¸

6. **é‡å¯æœåŠ¡**ï¼š
   ```bash
   # å¦‚æœä½¿ç”¨systemd
   sudo systemctl restart bbva-pdf-parser
   ```

### æ•…éšœæ’æŸ¥

#### æ£€æŸ¥æ¸…å•

1. âœ… æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`ps aux | grep api_server` æˆ–ä»»åŠ¡ç®¡ç†å™¨
2. âœ… ç«¯å£æ˜¯å¦ç›‘å¬ï¼š`netstat -an | grep 8000` æˆ– `lsof -i :8000`
3. âœ… æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ï¼šæŸ¥çœ‹ `api_server.log`
4. âœ… é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼šéªŒè¯ `config.yaml` è¯­æ³•
5. âœ… ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®ï¼š`echo $ANTHROPIC_API_KEY`
6. âœ… ä¾èµ–æ˜¯å¦å®Œæ•´ï¼š`pip list | grep -E "fastapi|uvicorn"`
7. âœ… ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³ï¼š`df -h` æˆ–æ£€æŸ¥ç£ç›˜å±æ€§
8. âœ… ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ï¼šæµ‹è¯•APIå¯†é’¥è®¿é—®

#### ç´§æ€¥æ¢å¤

å¦‚æœæœåŠ¡å®Œå…¨æ— æ³•å¯åŠ¨ï¼š

1. **å›æ»šåˆ°å¤‡ä»½ç‰ˆæœ¬**
2. **æ£€æŸ¥ç³»ç»Ÿèµ„æº**ï¼ˆå†…å­˜ã€ç£ç›˜ï¼‰
3. **æŸ¥çœ‹å®Œæ•´é”™è¯¯æ—¥å¿—**
4. **è”ç³»æŠ€æœ¯æ”¯æŒ**

---

## é™„å½•

### A. é¡¹ç›®æ–‡ä»¶ç»“æ„

```
bbva-pdf-parser_éƒ¨ç½²ç‰ˆæœ¬_20251126/
â”œâ”€â”€ api_server.py              # FastAPIæœåŠ¡å…¥å£
â”œâ”€â”€ main.py                    # å‘½ä»¤è¡Œå·¥å…·å…¥å£
â”œâ”€â”€ config.yaml                # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt           # æ ¸å¿ƒä¾èµ–
â”œâ”€â”€ requirements_api.txt       # APIæœåŠ¡ä¾èµ–
â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡ï¼ˆéœ€åˆ›å»ºï¼‰
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ éƒ¨ç½²æ–‡æ¡£.md                # æœ¬æ–‡æ¡£
â”œâ”€â”€ src/                       # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ pipeline.py         # ä¸»å¤„ç†æµç¨‹
â”‚   â”œâ”€â”€ llm_client.py         # LLMå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ bank_detector.py      # é“¶è¡Œæ£€æµ‹
â”‚   â”œâ”€â”€ ocr/                   # OCRæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ mineru_handler.py
â”‚   â”‚   â””â”€â”€ ocr_verifier.py
â”‚   â”œâ”€â”€ layout/                # å¸ƒå±€åˆ†æ
â”‚   â”‚   â”œâ”€â”€ layout_analyzer.py
â”‚   â”‚   â””â”€â”€ region_clustering.py
â”‚   â”œâ”€â”€ tables/                # è¡¨æ ¼å¤„ç†
â”‚   â”‚   â”œâ”€â”€ table_parser.py
â”‚   â”‚   â””â”€â”€ table_validator.py
â”‚   â”œâ”€â”€ extraction/            # æ•°æ®æå–
â”‚   â”‚   â”œâ”€â”€ data_extractor.py
â”‚   â”‚   â””â”€â”€ semantic_analyzer.py
â”‚   â”œâ”€â”€ validation/            # éªŒè¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ validator.py
â”‚   â”‚   â”œâ”€â”€ pdf_rebuilder.py
â”‚   â”‚   â””â”€â”€ pdf_comparator.py
â”‚   â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ schemas.py
â”‚   â””â”€â”€ export/                 # å¯¼å‡ºæ¨¡å—
â”‚       â””â”€â”€ excel_exporter.py
â”œâ”€â”€ prompts/                    # æç¤ºè¯æ¨¡æ¿
â”‚   â””â”€â”€ bbva_pdf_parsing_prompt.md
â”œâ”€â”€ inputs/                     # è¾“å…¥ç›®å½•ï¼ˆéœ€åˆ›å»ºï¼‰
â””â”€â”€ output/                     # è¾“å‡ºç›®å½•ï¼ˆéœ€åˆ›å»ºï¼‰
```

### B. ä¾èµ–åŒ…åˆ—è¡¨

#### æ ¸å¿ƒä¾èµ–ï¼ˆrequirements.txtï¼‰

- PyMuPDF (>=1.23.0) - PDFå¤„ç†
- reportlab (>=4.0.0) - PDFç”Ÿæˆ
- pillow (>=10.0.0) - å›¾åƒå¤„ç†
- pytesseract (>=0.3.10) - OCR
- pandas (>=2.1.0) - æ•°æ®å¤„ç†
- numpy (>=1.24.0) - æ•°å€¼è®¡ç®—
- pydantic (>=2.5.0) - æ•°æ®éªŒè¯
- opencv-python (>=4.8.0) - å›¾åƒå¤„ç†
- scikit-image (>=0.21.0) - å›¾åƒåˆ†æ
- openai (>=1.3.0) - OpenAI API
- anthropic (>=0.7.0) - Anthropic API
- python-dotenv (>=1.0.0) - ç¯å¢ƒå˜é‡
- pyyaml (>=6.0) - YAMLè§£æ

#### APIæœåŠ¡ä¾èµ–ï¼ˆrequirements_api.txtï¼‰

- fastapi (>=0.104.0) - Webæ¡†æ¶
- uvicorn[standard] (>=0.24.0) - ASGIæœåŠ¡å™¨
- python-multipart (>=0.0.6) - æ–‡ä»¶ä¸Šä¼ æ”¯æŒ

### C. APIå“åº”ç¤ºä¾‹

#### æˆåŠŸå“åº”

```json
{
  "success": true,
  "message": "PDFè§£ææˆåŠŸ",
  "data": {
    "metadata": {
      "document_type": "BBVA_STATEMENT",
      "bank": "BBVA Mexico",
      "account_number": "1234567890",
      "total_pages": 5
    },
    "structured_data": {
      "account_summary": {
        "initial_balance": "10000.00",
        "final_balance": "15000.00",
        "transactions": [...]
      }
    },
    "validation_metrics": {
      "extraction_completeness": 98.5,
      "content_accuracy": 99.2
    }
  },
  "metadata": {
    "document_type": "BBVA_STATEMENT",
    "transactions_count": 25,
    "extraction_completeness": 98.5
  },
  "processing_time": 12.34
}
```

#### é”™è¯¯å“åº”

```json
{
  "success": false,
  "message": "PDFè§£æå¤±è´¥",
  "error": "FileNotFoundError: PDF file not found",
  "processing_time": 0.12
}
```

### D. è”ç³»æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. é”™è¯¯ä¿¡æ¯ï¼ˆå®Œæ•´å †æ ˆè·Ÿè¸ªï¼‰
2. é…ç½®æ–‡ä»¶ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰
3. æ—¥å¿—æ–‡ä»¶ï¼ˆæœ€è¿‘çš„é”™è¯¯æ—¥å¿—ï¼‰
4. ç³»ç»Ÿä¿¡æ¯ï¼ˆæ“ä½œç³»ç»Ÿã€Pythonç‰ˆæœ¬ï¼‰
5. å¤ç°æ­¥éª¤

---

## æ–‡æ¡£ç‰ˆæœ¬

- **ç‰ˆæœ¬**: 1.0
- **æ—¥æœŸ**: 2025-01-26
- **ä½œè€…**: éƒ¨ç½²æ–‡æ¡£ç”Ÿæˆ
- **æœ€åæ›´æ–°**: 2025-01-26

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€

